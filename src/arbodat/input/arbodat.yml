entities:
  # Pandas drop_duplicates with a list of column names as arguments will:
  #   Look only at the values in col1 and col2 to determine if two rows are duplicates.
  #   Keep the first occurrence of each unique combination by default.
  #   Drop all other rows that have the same values in the specified subset of columns.
  #   Return the full rows — not just the subset — but duplicates are identified only from the subset.

  cultural_group:
    surrogate_id: cultural_group_id
    keys: ["KultGr"]
    columns: ["KultGr"]
    drop_duplicates: true
    depends_on: []

  epoch:
    surrogate_id: epoch_id
    keys: ["Epoche", "Epochen_Beschreibung"]
    columns: ["Epoche", "Epochen_Beschreibung"]
    drop_duplicates: "@value: entities.epoch.keys"
    depends_on: []

  archaeological_period:
    surrogate_id: archaeological_period_id
    keys: ["ArchDat", "ArchDat_Beschreibung"]
    columns: ["ArchDat", "ArchDat_Beschreibung"]
    drop_duplicates: "@value: entities.archaeological_period.keys"
    depends_on: []

  chronological_period:
    surrogate_id: chronological_period_id
    keys: ["ChronoDat", "ChronoDat Beschreibung"]
    columns: ["ChronoDat", "ChronoDat Beschreibung"]
    drop_duplicates: "@value: entities.chronological_period.keys"
    depends_on: []

  eco_groups:
    surrogate_id: eco_group_id
    keys: ["Ökogruppe"]
    columns: ["Ökogruppe", "Ökogruppe_u"]
    drop_duplicates: true
    depends_on: []

  remain_type_group:
    surrogate_id: remain_type_group_id
    keys: ["RTypGrup"]
    columns: ["RTypGrup"]
    drop_duplicates: true
    depends_on: []

  remain_type:
    surrogate_id: remain_type_id
    keys: ["RTyp", "RTypGrup"]
    columns: ["RTyp", "RTypGrup"]
    foreign_keys:
      - entity: remain_type_group
        local_keys: ["RTypGrup"]
        remote_keys: ["RTypGrup"]
    drop_duplicates: "@value: entities.remain_type.keys"
    depends_on: ["remain_type_group"]

  natural_region_group:
    surrogate_id: natural_region_group_id
    keys: ["NaturrEinh"]
    columns: ["NaturrEinh"]
    drop_duplicates: true
    depends_on: []

  natural_region:
    surrogate_id: natural_region_id
    keys: ["NaturE"]
    columns: ["NaturE", "NaturrEinh"]
    drop_duplicates: ["NaturE", "NaturrEinh"]
    foreign_keys:
      - entity: natural_region_group
        local_keys: ["NaturrEinh"]
        remote_keys: ["NaturrEinh"]
    depends_on: ["natural_region_group"]

  natural_sub_region:
    surrogate_id: natural_sub_region_id
    keys: ["NaturHaupteinheit"]
    columns: ["NaturHaupteinheit", "NaturE"]
    drop_duplicates: ["NaturHaupteinheit", "NaturE"]
    foreign_keys:
      - entity: natural_region
        local_keys: ["NaturE"]
        remote_keys: ["NaturE"]
    depends_on: ["natural_region"]

  location_type:
    source: null
    type: fixed
    surrogate_id: location_type_id
    surrogate_name: location_type
    columns: ["location_type"]
    extra_columns:
      arbodat_code: location_type
    values:
      - Ort
      - Kreis
      - Land
      - Staat
      - FlurStr

  location:
    surrogate_id: location_id
    keys: []
    columns: "@value: entities.location_type.values"
    extra_columns:
      default_lat_dd: null
      default_long_dd: null
    unnest:
      value_vars: "@value: entities.location_type.values"
      var_name: location_type
      value_name: location_name
    foreign_keys:
      - entity: location_type
        local_keys: ["location_type"]
        remote_keys: ["location_type"]
    drop_duplicates: "@value: entities.location.keys"
    depends_on: ["location_type"]

  site_coordinate:
    surrogate_id: site_coordinate_id
    keys: "@value: entities.site.keys"
    columns: ["Koordinatensystem", "Easting", "Northing", "Höhe"]
    drop_duplicates: "@value: entities.site.keys"
    check_functional_dependency: true
    depends_on: []

  site:
    surrogate_id: site_id
    keys: ["ProjektNr", "Fustel", "EVNr"]
    columns: ["ProjektNr", "Fustel", "EVNr"]
    extra_columns:
      site_name: "Fustel"
      national_site_identifier: "EVNr"
    foreign_keys:
      - entity: natural_region
        local_keys: ["NaturE", "NaturrEinh"]
        remote_keys: ["NaturE", "NaturrEinh"]
      - entity: site_coordinate
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
        extra_columns:
          coordinate_system: "Koordinatensystem"
          easting: "Easting"
          northing: "Northing"
          elevation: "Höhe"
        drop_remote_id: true
    drop_duplicates: "@value: entities.site.keys"
    depends_on: ["natural_region", "site_coordinate"]

  site_property_type:
    source: null
    type: fixed
    surrogate_id: site_property_type_id
    surrogate_name: site_property_type
    columns: ["@value: entities.site_property_type.surrogate_name"]
    extra_columns:
      description: site_property_type
    values:
      - "Limes"
      - "FustelTyp?"
      - "okFustel"
      - "TK"
      - "EVNr"

  site_property:
    surrogate_id: site_property_id
    columns:
      ["ProjektNr", "Fustel", "EVNr", "FustelTyp?", "okFustel", "Limes", "TK"]
    foreign_keys:
      - entity: site
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
      - entity: site_property_type
        local_keys: ["@value: entities.site_property_type.surrogate_name"]
        remote_keys: ["@value: entities.site_property_type.surrogate_name"]
    unnest:
      id_vars: ["ProjektNr", "Fustel", "EVNr"]
      value_vars: "@value: entities.site_property_type.values"
      var_name: site_property_type
      value_name: site_property_value
    drop_duplicates: true
    depends_on: ["site", "site_property_type"]

  site_type_group:
    surrogate_id: site_type_group_id
    keys: ["OFustelTyp"]
    columns: ["OFustelTyp", "OFustelTyp Beschreibung"]
    extra_columns:
      site_type_group: "OFustelTyp"
      description: "OFustelTyp Beschreibung"
    drop_duplicates: True
    depends_on: []

  site_type:
    surrogate_id: site_type_id
    keys: ["FustelTyp", "OFustelTyp"]
    columns: ["FustelTyp", "OFustelTyp", "Fundstellentyp_Beschreibung"]
    extra_columns:
      site_type: "FustelTyp"
      description: "Fundstellentyp_Beschreibung"
    drop_duplicates: "@value: entities.site_type.keys"
    foreign_keys:
      - entity: site_type_group
        local_keys: ["OFustelTyp"]
        remote_keys: ["OFustelTyp"]
    depends_on: ["site_type_group"]

  site_site_type:
    surrogate_id: site_site_type_id
    keys: []
    columns: []
    foreign_keys:
      - entity: site_type
        local_keys: "@value: entities.site_type.keys"
        remote_keys: "@value: entities.site_type.keys"
      - entity: site
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
    drop_duplicates: True
    depends_on: ["site", "site_type"]

  site_location:
    surrogate_id: site_location_id
    keys: []
    columns:
      [
        "ProjektNr",
        "Fustel",
        "EVNr",
        "Ort",
        "Kreis",
        "Land",
        "Staat",
        "FlurStr",
      ]
    foreign_keys:
      - entity: site
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
      - entity: location
        local_keys: ["location_type", "location_name"]
        remote_keys: ["location_type", "location_name"]
    unnest:
      id_vars: ["@value: entities.site.surrogate_id"]
      value_vars: "@value: entities.location.keys"
      var_name: location_type
      value_name: location_name
    drop_duplicates: "@value: entities.site_location.keys"
    depends_on: ["site", "location"]

  site_natural_region:
    surrogate_id: site_natural_region_id
    keys: []
    columns: ["NaturE"]
    foreign_keys:
      - entity: natural_region
        local_keys: "@value: entities.natural_region.keys"
        remote_keys: "@value: entities.natural_region.keys"
      - entity: site
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
    drop_duplicates: "@value: entities.natural_region.keys + @value: entities.site.keys"
    check_functional_dependency: true
    depends_on: ["site", "natural_region"]

  project:
    surrogate_id: project_id
    keys: ["ProjektNr"]
    columns: ["ProjektNr"]
    extra_columns:
      project_name: "ProjektNr"
      project_type_id: 0
      project_stage_id: 0
      project_abbrev_name: null
      description: null
    foreign_keys:
      - entity: site
        local_keys: ["ProjektNr"]
        remote_keys: ["ProjektNr"]
    drop_duplicates: true
    depends_on: ["site"]

  taxa:
    surrogate_id: taxon_id
    keys: ["BNam", "TaxAut"]
    columns:
      [
        "PCODE",
        "BNam",
        "Name D",
        "Name_E",
        "Name_F",
        "Name_I",
        "Familie",
        "S_Od",
        "TaxAut",
        "Achtung",
      ]
    extra_columns:
      system_id: 0
      author_id: 0
      genus_id: 0
      species: "Bnam"
    drop_duplicates: ["PCODE"]
    check_functional_dependency: true
    depends_on: []

  taxa_use_categories:
    surrogate_id: use_category_id
    keys: ["PCODE"]
    columns:
      ["PCODE", "Ess", "Gar", "Ge", "Hü", "Imp", "Kp", "Med", "Nut", "Öl"]
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
        drop_duplicates: ["taxon_id"]
    drop_duplicates: True
    drop_empty_rows: True
    depends_on: ["taxa"]

  taxa_plant_sociological_behaviour:
    surrogate_id: plant_sociological_behaviour_id
    keys: ["PCODE"]
    columns:
      [
        "PCODE",
        "G",
        "G_u",
        "Kl",
        "Kl_u",
        "O",
        "O_u",
        "Soz",
        "Soz_u",
        "U",
        "U_u",
        "V",
        "V_u",
        "Ökogruppe",
        "Ökogruppe_u",
      ]
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
        drop_duplicates: ["taxon_id"]
        check_functional_dependency: true
    drop_duplicates: True
    drop_empty_rows: True
    depends_on: ["taxa"]

  taxa_dominance:
    surrogate_id: dominance_id
    keys: ["PCODE"]
    columns: ["PCODE", "Dom", "Dom_u"]
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
        drop_duplicates: ["taxon_id"]
        check_functional_dependency: true
    drop_duplicates: True
    drop_empty_rows: True
    depends_on: ["taxa"]

  taxa_oberdorfer_characteristics:
    surrogate_id: oberdorfer_characteristics_id
    keys: ["PCODE"]
    columns:
      [
        "PCODE",
        "Anm",
        "ARE",
        "BLA",
        "BLE",
        "Pio",
        "Roh",
        "SozGrup",
        "WT",
        "WUA",
        "WUE",
        "Zeig",
      ]
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
        drop_duplicates: ["taxon_id"]
        check_functional_dependency: true
    drop_duplicates: True
    drop_empty_rows: True
    depends_on: ["taxa"]

  taxa_persistence:
    surrogate_id: persistence_id
    keys: ["PCODE"]
    columns: ["PCODE", "Bl", "Bl_u", "Leb"]
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
        drop_duplicates: ["taxon_id"]
        check_functional_dependency: true
    drop_duplicates: True
    drop_empty_rows: True
    depends_on: ["taxa"]

  taxa_briemle_characteristics:
    surrogate_id: briemle_characteristics_id
    keys: ["PCODE"]
    columns: ["PCODE", "FW", "M", "TKG", "W"]
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
        drop_duplicates: ["taxon_id"]
        check_functional_dependency: true
    drop_duplicates: True
    drop_empty_rows: True
    depends_on: ["taxa"]

  taxa_ecological_behaviour:
    surrogate_id: ecological_behaviour_id
    keys: ["PCODE"]
    columns:
      [
        "PCODE",
        "F",
        "F_s",
        "F_u",
        "K",
        "K_u",
        "L",
        "L_u",
        "N",
        "N_u",
        "Re",
        "Re_u",
        "S",
        "S_u",
        "SMet",
        "T",
        "T_u",
      ]
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
        drop_duplicates: ["taxon_id"]
        check_functional_dependency: true
    drop_duplicates: True
    drop_empty_rows: True
    depends_on: ["taxa"]

  sample:
    surrogate_id: sample_id
    keys: ["ProjektNr", "Befu", "ProbNr"]
    columns: ["ProjektNr", "Befu", "ProbNr", "EDatProb"]
    extra_columns:
      sample_name: "Befu"
      date_sampled: "EDatProb"
      alt_ref_type_id: null
    drop_duplicates: ["ProjektNr", "Befu", "ProbNr"]
    check_functional_dependency: true
    foreign_keys:
      - entity: feature
        local_keys: ["ProjektNr", "Befu"]
        remote_keys: ["ProjektNr", "Befu"]
      - entity: sample_group
        local_keys: ["ProjektNr", "Befu"]
        remote_keys: ["ProjektNr", "Befu"]
      - entity: sample_type
        local_keys: "@value: entities.sample_type.keys"
        remote_keys: "@value: entities.sample_type.keys"
    depends_on: ["feature", "sample_group", "sample_type"]

  sample_group:
    # rule: one-to-one relationship with feature
    surrogate_id: sample_group_id
    keys: ["ProjektNr", "Befu", "Fustel"]
    columns: ["ProjektNr", "Befu", "Fustel", "GrJahrBefu", "Gebäude", "okBefu"]
    extra_columns:
      sample_group_name: "Befu"
      sample_group_description: null
      sampling_context_id: null
      method_id: null
    drop_duplicates: true
    foreign_keys:
      - entity: site
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
    depends_on: ["site"]

  sample_taxa:
    keys: []
    columns: ["PCODE", "ProjektNr", "Befu", "ProbNr"]
    foreign_keys:
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
      - entity: taxa
        local_keys: "@value: entities.taxa.keys"
        remote_keys: "@value: entities.taxa.keys"
    drop_duplicates: "@value: entities.sample_taxa.keys"
    depends_on: ["sample", "taxa"]

  sample_type:
    surrogate_id: sample_type_id
    keys: ["ProbTyp"]
    columns: ["ProbTyp", "ProbTyp Beschreibung"]
    extra_columns:
      sample_type_name: "ProbTyp"
      sample_type_description: "ProbTyp Beschreibung"
    drop_duplicates: true
    depends_on: []

  sample_sample_type:
    surrogate_id: sample_sample_type_id
    keys: []
    columns: ["ProbTyp"]
    extra_columns:
      type_name: "ProbTyp"
      description: null
    foreign_keys:
      - entity: sample_type
        local_keys: "@value: entities.sample_type.keys"
        remote_keys: "@value: entities.sample_type.keys"
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
    drop_duplicates: True
    depends_on: ["sample", "sample_type"]

  sample_description_type:
    source: null
    type: fixed
    surrogate_id: sample_description_type_id
    surrogate_name: type_name
    columns: ["type_name", "type_description", "arbodat_code"]
    type_names:
      [
        "Vorfu",
        "AblaBdgProb",
        "EDatProb",
        "Strat",
        "Schi",
        "Quadr",
        "Plan",
        "Prob_üNN",
        "TK",
        "SedProb",
        "KultGr",
      ]
    values:
      - ["Is mass find?", "Indicates of sample is a mass find.", "Vorfu"]
      - ["Wet/dry?", "?", "AblaBdgProb"]
      - ["Sampling date", "Sampling date", "EDatProb"]
      - ["Stratigraphy", "Stratigraphic unit or description.", "Strat"]
      - ["Layer", "Layer identifier", "Schi"]
      - ["Square/Grid", "Excavation square/grid square.", "Quadr"]
      - ["Planum", "Planum", "Plan"]
      - ["Elevation ASL", "Elevation of sample above sea level.", "Prob_üNN"]
      - ["Map sheet", "German topographic map sheet number.", "TK"]
      - ["Sediment", "Indicates whether the sample is sediment.", "SedProb"]
      - ["Cultural group", "Cultural group", "KultGr"]

  sample_cultural_group:
    surrogate_id: sample_cultural_group_id
    keys: []
    columns: []
    foreign_keys:
      - entity: cultural_group
        local_keys: "@value: entities.cultural_group.keys"
        remote_keys: "@value: entities.cultural_group.keys"
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
    drop_duplicates: True
    depends_on: ["sample", "cultural_group"]

  contact:
    surrogate_id: contact_id
    keys: ["ArchAusg", "ArchBear", "BotBear", "Aut", "BotBest"]
    columns: ["ArchAusg", "ArchBear", "BotBear", "Aut", "BotBest"]
    drop_duplicates: "@value: entities.contact.keys"
    unnest:
      id_vars: ["@value: entities.contact.surrogate_id"]
      value_vars: "@value: entities.contact.keys"
      var_name: contact_type
      value_name: contact_name
    depends_on: ["contact_type"]

  contact_type:
    source: null
    type: fixed
    surrogate_id: contact_type_id
    surrogate_name: contact_type
    columns: ["contact_type_name", "description", "arbodat_code"]
    values:
      [
        ["ArchBear", null, "ArchBear"],
        ["BotBear", null, "BotBear"],
        ["Aut", null, "Aut"],
        ["BotBest", null, "BotBest"],
        ["ArchAusg", null, "ArchAusg"],
      ]

  dimensions:
    surrogate_id: "dimension_id"
    type: fixed
    columns: ["dimension_id", "dimension_name"]
    drop_duplicates: true
    depends_on: []
    values: |
      sql: 
      select dimension_id, dimension_name
      from public.tbl_dimensions

  feature_type:
    surrogate_id: feature_type_id
    keys: ["ProjektNr", "Befu"]
    columns: ["BefuTyp"]
    extra_columns:
      feature_type_name: "BefuTyp"
      feature_type_description: null
    drop_duplicates: true
    foreign_keys:
      - entity: site
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
    depends_on: ["site"]

  feature:
    surrogate_id: feature_id
    keys: ["ProjektNr", "Befu"]
    columns:
      [
        "ProjektNr",
        "Fustel",
        "EVNr",
        "Befu",
        "BefuTyp",
        "GrJahrBefu",
        "Gebäude",
        "okBefu",
      ]
    drop_duplicates: true
    foreign_keys:
      - entity: site
        local_keys: "@value: entities.site.keys"
        remote_keys: "@value: entities.site.keys"
    depends_on: ["site", "feature_type"]

  sample_archaeological_period:
    surrogate_id: sample_archaeological_period_id
    keys: []
    columns: []
    foreign_keys:
      - entity: archaeological_period
        local_keys: "@value: entities.archaeological_period.keys"
        remote_keys: "@value: entities.archaeological_period.keys"
      - entity: taxa
        local_keys: "@value: entities.taxa.keys"
        remote_keys: "@value: entities.taxa.keys"
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
    drop_duplicates: True
    depends_on: ["sample", "archaeological_period"]

  sample_chronological_period:
    surrogate_id: sample_chronological_period_id
    keys: []
    columns: []
    foreign_keys:
      - entity: chronological_period
        local_keys: "@value: entities.chronological_period.keys"
        remote_keys: "@value: entities.chronological_period.keys"
      - entity: taxa
        local_keys: "@value: entities.taxa.keys"
        remote_keys: "@value: entities.taxa.keys"
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
    drop_duplicates: True
    depends_on: ["sample", "chronological_period", "taxa"]

  coordinate_method_dimension:
    surrogate_id: "coordinate_method_dimension_id"
    type: fixed
    columns:
      [
        "coordinate_type",
        "limit_lower",
        "limit_upper",
        "dimension_id",
        "method_id",
      ]
    values:
      - ["KoordX", null, null, null, null]
      - ["KoordY", null, null, null, null]
      - ["KoordZ", null, null, null, null]
      - ["TiefeBis", null, null, null, null]
      - ["TiefeVon", null, null, null, null]

  sample_coordinate:
    surrogate_id: sample_coordinate_id
    keys: []
    columns: ["KoordX", "KoordY", "KoordZ", "TiefeBis", "TiefeVon"]
    unnest:
      id_vars: "@value: entities.sample.keys"
      value_vars: ["KoordX", "KoordY", "KoordZ", "TiefeBis", "TiefeVon"]
      var_name: coordinate_type
      value_name: coordinate_value
    foreign_keys:
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
    drop_duplicates: True
    depends_on: ["sample", "coordinate_method_dimension"]

  sample_description:
    surrogate_id: sample_description_id
    keys: []
    columns: "@value: entities.sample_description_type.type_names"
    foreign_keys:
      - entity: sample_description_type
        local_keys: ["type_name"]
        remote_keys: ["arbodat_code"]
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
    unnest:
      id_vars: "@value: entities.sample.keys"
      value_vars: "@value: entities.sample_description_type.type_names"
      var_name: type_name
      value_name: description_value
    drop_duplicates: True
    drop_empty_rows: ["description_value"]
    depends_on: ["sample", "sample_description_type"]

  master_dataset:
    surrogate_id: master_dataset_id
    type: fixed
    columns:
      [
        "master_dataset_id",
        "contact_id",
        "biblio_id",
        "master_name",
        "master_notes",
        "url",
      ]
    values: [[1, null, null, "ArboDat Pilot", null, null]]
    depends_on: []

  dataset:
    surrogate_id: dataset_id
    keys: "@value: entities.sample.keys + [ 'method_name', 'method_type' ]"
    columns: "@value: entities.sample.keys + [ 'method_name', 'method_type' ]"
    extra_columns:
      dataset_type_id: null
      dataset_name: null
      master_set_id: 1
      data_status_id: 1
    foreign_keys:
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
      - entity: sample_method
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
        extra_columns:
          method_name: "method_id"
      - entity: project
        local_keys: "@value: entities.project.keys"
        remote_keys: "@value: entities.project.keys"
    drop_duplicates: true
    depends_on: ["sample", "sample_method", "project"]

  method_group:
    type: fixed
    columns: ["method_group_id", "group_name", "description"]
    values: |
      sql: 
      select "method_group_id", "group_name", "description"
      from public.tbl_method_groups
    depends_on: []

  sample_method:
    surrogate_id: sample_method_id
    keys: []
    columns: "@value: entities.method.process_names"
    foreign_keys:
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
      - entity: method
        local_keys: ["method_name"]
        remote_keys: ["arbodat_code"]
    unnest:
      id_vars: "@value: entities.sample.keys + [ 'sample_method_id' ]"
      value_vars: "@value: entities.method.process_names"
      var_name: method_type
      value_name: method_name
    drop_duplicates: true
    depends_on: ["sample", "method"]

  method:
    surrogate_id: method_id
    type: fixed
    process_names:
      [
        "ORG2,0",
        "ORG1,0",
        "ORG0,5",
        "ORG0,25",
        "MIN2,0",
        "MIN1,0",
        "MIN0,5",
        "MIN0,25",
      ]
    columns:
      [
        "biblio_id",
        "description",
        "method_name",
        "method_abbrev_or_alt_name",
        "method_group_id",
        "arbodat_code",
      ]
    values:
      [
        [null, "Organic remains >2.0 mm", "ORG2,0", "ORG2,0", null, "ORG2,0"],
        [
          null,
          "Organic remains 1.0-2.0 mm",
          "ORG1,0",
          "ORG1,0",
          null,
          "ORG1,0",
        ],
        [
          null,
          "Organic remains 0.5-1.0 mm",
          "ORG0,5",
          "ORG0,5",
          null,
          "ORG0,5",
        ],
        [
          null,
          "Organic remains 0.25-0.5 mm",
          "ORG0,25",
          "ORG0,25",
          null,
          "ORG0,25",
        ],
        [null, "Mineral remains >2.0 mm", "MIN2,0", "MIN2,0", null, "MIN2,0"],
        [
          null,
          "Mineral remains 1.0-2.0 mm",
          "MIN1,0",
          "MIN1,0",
          null,
          "MIN1,0",
        ],
        [
          null,
          "Mineral remains 0.5-1.0 mm",
          "MIN0,5",
          "MIN0,5",
          null,
          "MIN0,5",
        ],
        [
          null,
          "Mineral remains 0.25-0.5 mm",
          "MIN0,25",
          "MIN0,25",
          null,
          "MIN0,25",
        ],
      ]
    depends_on: []

  modification_type:
    surrogate_id: modification_type_id
    keys: ["Zust"]
    columns: ["Zust", "Zustand"]
    extra_columns:
      modification_type_name: "Zust"
      modification_type_description: "Zustand"
    drop_duplicates: ["Zust"]
    depends_on: []

  result:
    surrogate_id: result_id
    analysis_keys: ["Fraction", "cf", "RTyp", "Zustand"]
    value_columns:
      ["SumFAnzahl", "SumFFrag", "SumFGewicht", "SumPflR", "Zust", "geschätzt"]
    keys: "@value: entities.sample.keys + ['PCODE'] + @value: entities.result.analysis_keys"
    columns: "@value: entities.sample_taxa.keys + @value: entities.result.value_columns"
    foreign_keys:
      - entity: taxa
        local_keys: ["PCODE"]
        remote_keys: ["PCODE"]
      - entity: sample
        local_keys: "@value: entities.sample.keys"
        remote_keys: "@value: entities.sample.keys"
      - entity: modification_type
        local_keys: ["Zust"]
        remote_keys: ["Zust"]
      - entity: remain_type
        local_keys: ["RTyp"]
        remote_keys: ["RTyp"]
    drop_empty_rows: ["SumFAnzahl", "SumFFrag", "SumFGewicht", "SumPflR"]
    depends_on: ["taxa", "sample", "modification_type", "remain_type"]

  ############################## STATUS OK DIVIDER ###############################

  # sample_epoch:
  #   surrogate_id: sample_epoch_id
  #   keys: []
  #   columns: []
  #   foreign_keys:
  #     - entity: epoch
  #       local_keys: "@value: entities.epoch.keys"
  #       remote_keys: "@value: entities.epoch.keys"
  #     - entity: sample
  #       local_keys: "@value: entities.sample.keys"
  #       remote_keys: "@value: entities.sample.keys"
  #     - entity: taxa
  #       local_keys: "@value: entities.taxa.keys"
  #       remote_keys: "@value: entities.taxa.keys"
  #   drop_duplicates: True
  #   depends_on: ["sample", "epoch", "taxa"]

# FIXME: add contacts to
# tbl_dataset_contacts
# tbl_dataset_masters
# tbl_dataset_submissions
# tbl_dating_labs

translation: "@load: options.translations"

options:
  translations:
    filename: translations.tsv
    delimiter: "\t"
