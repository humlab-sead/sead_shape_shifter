metadata:
  name: arbodat
  type: shapeshifter-project
  description: Configuration for importing data from ArboDat database into SEAD.
  version: 1.0.0
  default_entity: survey
entities:
  abundance:
    type: sql
    public_id: abundance_id
    keys: '@value: entities.analysis_entity.keys'
    columns:
    - rAnzahl
    - rGewicht
    - geschätzt
    - rFrag
    - Multiplikator
    - FAnzahl
    - FFragmente
    - FGewicht
    - EDatProb
    - AnmFrakt
    foreign_keys:
    - entity: analysis_entity
      local_keys: []
      remote_keys: []
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    - entity: abundance_element
      local_keys: [RTyp]
      remote_keys: [RTyp]
    depends_on: [analysis_entity]
    extra_columns:
      abundance: FAnzahl
    data_source: arbodat_data
    query: "select [Projekt], [Befu], [ProbNr], [PCODE], [Fraktion], [cf], [RTyp], [Zust], [rAnzahl], [rGewicht], [geschätzt], [rFrag], [Multiplikator], [FAnzahl], [FFragmente], [FGewicht], [EDatProb], [AnmFrakt]\r\nfrom [Details];"
  abundance_element:
    type: sql
    source:
    public_id: abundance_element_id
    keys: [RTyp]
    columns: [Resttyp, RTypGrup, RTypNr]
    foreign_keys:
    - entity: abundance_element_group
      local_keys: [RTypGrup]
      remote_keys: [RTypGrup]
    depends_on: [abundance_element_group]
    extra_columns:
      element_name: RTyp
      element_description: Resttyp
    data_source: arbodat_lookup
    query: select [RTyp], [Resttyp], [RTypGrup], [RTypNr] from [RTyp];
  abundance_element_group:
    type: sql
    source:
    public_id: abundance_element_group_id
    keys: [RTypGrup]
    columns: [RTypGrup_EN, Nummer]
    depends_on: []
    data_source: arbodat_lookup
    query: "select [RTypGrup], [RTypGrup_EN], [Nummer]\nfrom [RtypGruppen];\n"
  abundance_modification:
    type: entity
    source: abundance
    public_id: abundance_modification_id
    keys: []
    columns: [Zust]
    foreign_keys:
    - entity: modification_type
      local_keys: [Zust]
      remote_keys: [Zust]
    depends_on: [abundance]
  abundance_property:
    type: entity
    source: abundance
    public_id: abundance_property_id
    keys: []
    columns: "@value: entities.abundance_property_type.arbodat_codes + ['abundance_id']"
    foreign_keys:
    - entity: abundance_property_type
      local_keys: [abundance_property_type]
      remote_keys: [arbodat_code]
    depends_on: [abundance, abundance_property_type]
    drop_duplicates: true
    drop_empty_rows:
      abundance_property_value: [null, '']
    unnest:
      id_vars: [abundance_id]
      value_vars: '@value: entities.abundance_property_type.arbodat_codes'
      var_name: abundance_property_type
      value_name: abundance_property_value
  abundance_property_type:
    type: fixed
    source:
    public_id: abundance_property_type_id
    keys: [abundance_property_type_id]
    columns: [system_id, abundance_property_type_id, abundance_property_type, description, arbodat_code]
    values:
    - [1, null, raw_count, Number of plant remains of the corresponding taxon, rAnzahl]
    - [2, null, raw_weight, Weight of plant remains of the corresponding taxon (mainly charcoal), rGewicht]
    - [3, null, estimated_amount, Semi-quantitatively estimated plant remains of the corresponding taxon, geschätzt]
    - [4, null, raw_fragments, Fragments (if present), rFrag]
    - [5, null, multiplier, Total weight / evaluated weight, Multiplikator]
    - [6, null, extrapolated_count, Extrapolated count, FAnzahl]
    - [7, null, extrapolated_fragments, Extrapolated fragments, FFragmente]
    - [8, null, extrapolated_weight, Extrapolated weight, FGewicht]
    - [9, null, entry_date, Entry date, EDatProb]
    - [10, null, note, Note, AnmFrakt]
    depends_on: []
    arbodat_codes:
    - rAnzahl
    - rGewicht
    - geschätzt
    - rFrag
    - Multiplikator
    - FAnzahl
    - FFragmente
    - FGewicht
    - EDatProb
    - AnmFrakt
    surrogate_name: abundance_property_type
  analysis_entity:
    type: sql
    source:
    public_id: analysis_entity_id
    keys:
    - Projekt
    - Befu
    - ProbNr
    - PCODE
    - Fraktion
    - cf
    - RTyp
    - Zust
    columns: []
    foreign_keys:
    - entity: sample
      local_keys: [Projekt, Befu, ProbNr]
      remote_keys: [Projekt, Befu, ProbNr]
      constraints:
        allow_unmatched_left: false
        allow_null_keys: false
        cardinality: many-to-one
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
      how: left
      constraints:
        allow_unmatched_left: false
        allow_null_keys: false
    - entity: method
      local_keys: [Fraktion]
      remote_keys: [arbodat_code]
      how: left
      constraints:
        allow_unmatched_left: false
        cardinality: many-to-one
    depends_on: [method, taxa, sample]
    data_source: arbodat_data
    query: select [Projekt], [Befu], [ProbNr], [PCODE], [Fraktion], [cf], [RTyp], [Zust] from [Details];
  archaeological_period:
    type: sql
    source:
    public_id: archaeological_period_id
    keys: [ArchDat]
    columns: [ArchDat, Beschreibung, Epoche, Nummer]
    foreign_keys:
    - entity: epoch
      local_keys: [Epoche]
      remote_keys: [Epoche]
    depends_on: [epoch]
    data_source: arbodat_lookup
    query: select distinct [ArchDat], [Beschreibung], [Epoche], [Nummer] from [ArchDat] ;
  chronological_period:
    type: sql
    source:
    public_id: chronological_period_id
    keys: [ChronoDat]
    columns: [ChronoDat, Beschreibung, Nummer, von, bis]
    depends_on: []
    data_source: arbodat_lookup
    query: select distinct [ChronoDat], [Beschreibung], [Nummer], [von], [bis] from [ChronoDat] ;
  contact:
    type: entity
    source: _project_contact
    public_id: contact_id
    keys: []
    columns: [contact_name, contact_type]
    foreign_keys:
    - entity: contact_type
      local_keys: [contact_type]
      remote_keys: [arbodat_code]
    depends_on: [contact_type, _project_contact]
    drop_duplicates: true
    append:
      source:
      data_source: arbodat_data
      check_column_names: false
      type: sql
      query: "select distinct [BotBest], \"BotBest\" from [Befunde] where [BotBest] is not null ;\n"
  contact_type:
    type: fixed
    source:
    public_id: contact_type_id
    keys: [arbodat_code]
    columns: [system_id, contact_type_id, contact_type, description, arbodat_code]
    values:
    - [1, null, Archaeologist, Name of scientist responsible for processing the archaeological material, ArchBear]
    - [2, null, Botanist, Name of scientist responsible for the botanical determination (possibly several persons), BotBear]
    - [3, null, 'Author(s) ', Publication/manuscript/short report, Aut]
    - [4, null, Bot. Determination, 'Name(s) of person(s) responsible for charcoal or seed/fruit determination, etc', BotBest]
    - [5, null, Site Director/Institution, Name of site director and/or institution, ArchAusg]
    contact_types: [ArchAusg, ArchBear, BotBear, Aut, BotBest]
    surrogate_name: contact_type
  coordinate_method_dimension:
    type: fixed
    source:
    public_id: coordinate_method_dimension_id
    keys: []
    columns:
    - system_id
    - coordinate_method_dimension_id
    - method_name
    - limit_upper
    - limit_lower
    - arbodat_dimension_code
    values:
    - [1, null, Local or unknown grid, null, null, KoordX]
    - [2, null, Local or unknown grid, null, null, KoordY]
    - [3, null, Local or unknown grid, null, null, KoordZ]
    - [4, null, Altitude above sea level, null, null, Prob_üNN]
    foreign_keys:
    - entity: dimension
      local_keys: [arbodat_dimension_code]
      remote_keys: [arbodat_code]
      how: left
    - entity: method
      local_keys: [method_name]
      remote_keys: [method_name]
      constraints:
        allow_unmatched_left: false
        allow_null_keys: false
      how: left
    depends_on: [dimension, method]
  coordinate_system:
    type: sql
    source:
    public_id: coordinate_system_id
    keys: [Koordsys]
    columns: [Index, Koordsys, Bemerkung]
    depends_on: []
    drop_duplicates: true
    data_source: arbodat_lookup
    query: select distinct [Index], [Koordsys], [Bemerkung] from [KoordSys] ;
  cultural_group:
    type: sql
    source:
    public_id: cultural_group_id
    keys: [KultGr]
    columns: [KultGr, Cult_EN]
    depends_on: []
    drop_duplicates: true
    data_source: arbodat_lookup
    query: select distinct KultGr, Cult_EN from Kulturgruppen;
  dataset:
    type: entity
    source: analysis_entity
    public_id: dataset_id
    keys: [Projekt, Fraktion]
    columns: [Projekt, Fraktion]
    foreign_keys:
    - entity: project
      local_keys: [Projekt]
      remote_keys: [Projekt]
    - entity: method
      local_keys: [Fraktion]
      remote_keys: [arbodat_code]
    - entity: master_dataset
      local_keys: [master_set_id]
      remote_keys: [master_set_id]
    depends_on: [method, project]
    drop_duplicates: true
    extra_columns:
      dataset_type_id:
      dataset_name: method_name
      master_set_id: 1
      data_type_id:
      biblio_id:
  dataset_contacts:
    type: entity
    source: dataset
    public_id: dataset_contact_id
    keys: [Projekt, Fraktion, contact_id]
    columns: []
    foreign_keys:
    - entity: _project_contact
      local_keys: [Projekt]
      remote_keys: [Projekt]
      extra_columns:
        contact_name: contact_name
    - entity: contact
      local_keys: [contact_name]
      remote_keys: [contact_name]
    depends_on: [_project_contact, contact, dataset, project]
    drop_duplicates: [Projekt, Fraktion, contact_id]
  dataset_submission:
    type: entity
    source: dataset
    public_id: dataset_submission_id
    keys: []
    columns: [dataset_id]
    foreign_keys:
    - entity: dataset_submission_type
      local_keys: [submission_type_id]
      remote_keys: [dataset_submission_type_id]
    depends_on: [dataset]
    extra_columns:
      date_submitted:
      submission_type_id: 1
      notes:
  dataset_submission_type:
    type: fixed
    source:
    public_id: dataset_submission_type_id
    keys: []
    columns: [system_id, dataset_submission_type_id]
    values:
    - [1, 4]
    depends_on: []
  dating:
    type: sql
    source:
    public_id: dating_id
    keys: [Projekt, Befu, ProbNr]
    columns:
    - Projekt
    - Befu
    - ProbNr
    - Unterprobe
    - Labornummer
    - Material
    - Methode
    - Waldkante
    - C14-Alter BP
    - Standardab C14
    - C14 cal
    - Dendroalter
    - Alter andere
    - 13C PDB-Wert
    - Standardab 13C PDB
    - pMC-Wert
    - Standardab PMC
    - Anmerkungen
    foreign_keys:
    - entity: sample
      local_keys: [Projekt, Befu, ProbNr]
      remote_keys: [Projekt, Befu, ProbNr]
    depends_on: [sample]
    drop_duplicates: true
    data_source: arbodat_data
    query: "select distinct\n  [Projekt],\n  [Befu],\n  [ProbNr],\n  [Unterprobe],\n  [Labornummer],\n  [Material],\n  [Methode],\n  [Waldkante],\n  [C14-Alter BP],\n  [Standardab C14],\n  [C14 cal],\n  [Dendroalter],\n  [Alter andere],\n  [13C PDB-Wert],\n  [Standardab 13C PDB],\n  [pMC-Wert],\n  [Standardab PMC],\n  [Anmerkungen]\nfrom [Datierung] ;\n"
  dating_period:
    type: sql
    source:
    public_id: dating_period_id
    keys: '@value: entities.sample.keys'
    columns: "@value: entities.sample.keys + ['ChronoDat', 'ArchDat']"
    foreign_keys:
    - entity: sample
      local_keys: '@value: entities.sample.keys'
      remote_keys: '@value: entities.sample.keys'
    - entity: chronological_period
      local_keys: [ChronoDat]
      remote_keys: [ChronoDat]
      how: left
    - entity: archaeological_period
      local_keys: [ArchDat]
      remote_keys: [ArchDat]
      how: left
    depends_on: [sample]
    drop_empty_rows: [ChronoDat, ArchDat]
    data_source: arbodat_data
    query: "select distinct [Projekt], [Befu], [ProbNr], [ChronoDat], [ArchDat]\nfrom [Proben] ;\n"
  dimension:
    type: fixed
    source:
    public_id: dimension_id
    keys: []
    columns:
    - system_id
    - dimension_id
    - dimension_name
    - dimension_abbrev
    - dimension_description
    - method_group_id
    - unit_id
    - arbodat_code
    values:
    - [1, null, X/North, X/N, X coordinate or Northing in intrinsic units., 17, 5, KoordX]
    - [2, null, X/East, X/E, X coordinate or Easting in intrinsic units., 17, 5, KoordY]
    - [3, null, Z/Altitude, Z/Alt, Z coordinate or Altitude in intrinsic units., 17, 5, KoordZ]
    - [4, null, Sampling height above sea level, Sampling ASL, Sampling height above sea level., 17, 1, Prob_üNN]
    depends_on: []
  epoch:
    type: sql
    source:
    public_id: epoch_id
    keys: [Epoche]
    columns: [Epoche, Beschreibung, Epoch_EN, Nummer]
    depends_on: []
    data_source: arbodat_lookup
    query: select distinct [Epoche], [Beschreibung], [Epoch_EN], [Nummer] from [Epochen] ;
  feature:
    type: sql
    source:
    public_id: feature_id
    keys: [Projekt, Befu]
    columns:
    - FlSchn
    - BefuTyp
    - FuTypVermut
    - gebäud
    - okBefu
    - okErh
    - BotBest
    - BestJa
    - Anmerkung
    foreign_keys:
    - entity: project
      local_keys: [Projekt]
      remote_keys: [Projekt]
      extra_columns:
        site_id: site_id
    - entity: feature_type
      local_keys: [BefuTyp]
      remote_keys: [Befundtyp]
      how: left
    depends_on: [project]
    drop_duplicates: [Projekt, Befu]
    data_source: arbodat_data
    query: select [Projekt], [Befu], [FlSchn], [BefuTyp], [FuTypVermut], [gebäud], [okBefu], [okErh], [BotBest], [BestJa], [Anmerkung] from [Befunde]
  feature_property:
    type: sql
    source:
    public_id: feature_property_id
    keys: [Projekt, Befu, feature_property_type]
    columns: '@value: entities.feature_property_type.values'
    foreign_keys:
    - entity: feature
      local_keys: '@value: entities.feature.keys'
      remote_keys: '@value: entities.feature.keys'
    - entity: feature_property_type
      local_keys: [feature_property_type]
      remote_keys: [arbodat_code]
      how: left
    depends_on: [feature, feature_property_type]
    drop_duplicates: [Projekt, Befu, feature_property_type]
    unnest:
      id_vars: '@value: entities.feature.keys'
      value_vars: '@value: entities.feature_property_type.values'
      var_name: feature_property_type
      value_name: feature_property_value
    data_source: arbodat_data
    query: select [Projekt], [Befu], [FlSchn], [gebäud], [okBefu], [okErh], [BestJa], [Anmerkung] from [Befunde] ;
  feature_property_type:
    type: fixed
    public_id: feature_property_type_id
    keys: []
    columns: [arbodat_code]
    values:
    - gebäud
    - okBefu
    - okErh
    - BestJa
    - FlSchn
    - Anmerkung
    extra_columns:
      feature_property_type: 1
      feature_property_name: 1
      feature_property_description: 1
    surrogate_names: feature_property_type
  feature_type:
    type: sql
    source:
    public_id: feature_type_id
    keys: []
    columns: [Befundtyp, Beschreibung]
    depends_on: []
    drop_duplicates: true
    extra_columns:
      feature_type_name: Befundtyp
      description: Beschreibung
    data_source: arbodat_lookup
    query: select [Befundtyp], [Beschreibung] from [Befundtypen];
  identification_level:
    type: sql
    public_id: identification_level_id
    keys: []
    columns: [identification_level_id, identification_level_abbrev, identification_level_name, notes]
    data_source: sead
    query: select identification_level_id, identification_level_abbrev, identification_level_name, notes from public.tbl_identification_levels
  location:
    type: sql
    source:
    public_id: location_id
    keys: []
    columns: [Ort, Kreis, Land, Staat, FlurStr]
    foreign_keys:
    - entity: location_type
      local_keys: [location_type]
      remote_keys: [location_type]
    depends_on: [location_type]
    drop_duplicates: [location_type, location_name]
    unnest:
      value_vars: '@value: entities.location.columns'
      var_name: location_type
      value_name: location_name
      id_vars: []
    extra_columns:
      default_lat_dd:
      default_long_dd:
    data_source: arbodat_data
    query: "select distinct [Ort], [Kreis], [Land], [Staat], [FlurStr] from [Projekte] ;\n"
  location_type:
    type: fixed
    source:
    public_id: location_type_id
    keys: []
    columns: [system_id, location_type_id, location_type]
    values:
    - [1, null, Ort]
    - [2, null, Kreis]
    - [3, null, Land]
    - [4, null, Staat]
    - [5, null, FlurStr]
    extra_columns:
      arbodat_code: location_type
    surrogate_name: location_type
  master_dataset:
    type: fixed
    public_id: master_set_id
    keys: []
    columns:
    - master_set_id
    - contact_id
    - biblio_id
    - master_name
    - master_notes
    - url
    values:
    - [1, null, null, ArboDat Pilot, null, null]
    depends_on: []
  method:
    type: fixed
    public_id: method_id
    keys: []
    columns:
    - system_id
    - method_id
    - biblio_id
    - description
    - method_name
    - method_abbrev_or_alt_name
    - method_group_id
    - arbodat_code
    values:
    - [1, null, null, Organic remains >2.0 mm, 'ORG 2,0', 'ORG 2,0', null, 'ORG 2,0']
    - [2, null, null, Organic remains 1.0-2.0 mm, 'ORG 1,0', 'ORG 1,0', null, 'ORG 1,0']
    - [3, null, null, Organic remains 0.5-1.0 mm, 'ORG 0,5', 'ORG 0,5', null, 'ORG 0,5']
    - [4, null, null, Organic remains 0.25-0.5 mm, 'ORG 0,25', 'ORG 0,25', null, 'ORG 0,25']
    - [5, null, null, Mineral remains >2.0 mm, 'MIN 2,0', 'MIN 2,0', null, 'MIN 2,0']
    - [6, null, null, Mineral remains 1.0-2.0 mm, 'MIN 1,0', 'MIN 1,0', null, 'MIN 1,0']
    - [7, null, null, Mineral remains 0.5-1.0 mm, 'MIN 0,5', 'MIN 0,5', null, 'MIN 0,5']
    - [8, null, null, Mineral remains 0.25-0.5 mm, 'MIN 0,25', 'MIN 0,25', null, 'MIN 0,25']
    - [9, 105, null, null, Local or unknown grid, null, null, null]
    - [10, 76, null, null, Altitude above sea level, null, null, null]
    foreign_keys:
    - entity: method_group
      local_keys: [method_group_id]
      remote_keys: [system_id]
  method_group:
    type: sql
    public_id: method_group_id
    keys: [method_group_id]
    columns: [method_group_id, group_name, description]
    depends_on: []
    data_source: sead
    query: select "method_group_id", "group_name", "description" from public.tbl_method_groups
  modification_type:
    type: sql
    public_id: modification_type_id
    keys: [Zust]
    columns: [Zust, Zustand, Nummer]
    extra_columns:
      modification_type_name: Zust
      modification_type_description: Zustand
    data_source: arbodat_lookup
    query: "select [Zust], [Zustand], [Nummer]\r\nfrom [Zustand];"
  natural_region:
    type: sql
    source:
    public_id: natural_region_id
    keys: [NaturE]
    columns: [NaturE, NaturrEinh, NatHauptNr]
    foreign_keys:
    - entity: natural_region_group
      local_keys: [NatHauptNr]
      remote_keys: [NatHauptNr]
    depends_on: [natural_region_group]
    data_source: arbodat_lookup
    query: select [NaturE], [NaturrEinh], [NatHauptNr] from [NaturE];
  natural_region_group:
    type: sql
    source:
    public_id: natural_region_group_id
    keys: [NatHauptNr]
    columns: [NaturHaupteinheit]
    depends_on: []
    data_source: arbodat_lookup
    query: select [NatHauptNr], [NaturHaupteinheit] from [NaturHaupt];
  project:
    type: sql
    source:
    public_id: project_id
    keys: [Projekt, Fustel]
    columns: []
    foreign_keys:
    - entity: site
      local_keys: [Fustel]
      remote_keys: [Fustel]
    depends_on: []
    extra_columns:
      project_name: Projekt
      project_type_id: 0
      project_stage_id: 0
      project_abbrev_name:
      description:
    data_source: arbodat_data
    query: select distinct [Projekt], [Fustel] from [Projekte];
  relative_dating:
    type: entity
    source: sample
    public_id: relative_age_id
    keys: [Projekt, Befu, ProbNr]
    columns: [Projekt, Befu, ProbNr, ArchDat]
    depends_on: [sample]
    drop_duplicates: true
    extra_columns:
      relative_age_id:
      method_id:
      notes:
      dating_uncertainty_id:
  sample:
    type: sql
    source:
    public_id: physical_sample_id
    keys: [Projekt, Befu, ProbNr]
    columns:
    - Projekt
    - Befu
    - ProbNr
    - ProbTyp
    - ArchDat
    - ChronoDat
    foreign_keys:
    - entity: feature
      local_keys: [Projekt, Befu]
      remote_keys: [Projekt, Befu]
      constraints:
        allow_unmatched_left: false
        allow_null_keys: false
        cardinality: many-to-one
    - entity: sample_group
      local_keys: [Projekt, Befu]
      remote_keys: [Projekt, Befu]
      constraints:
        allow_unmatched_left: false
        allow_null_keys: false
        cardinality: many-to-one
    - entity: sample_type
      local_keys: [ProbTyp]
      remote_keys: [ProbTyp]
    depends_on: [feature, sample_type, sample_group]
    drop_duplicates: [Projekt, Befu, ProbNr]
    extra_columns:
      sample_name: Befu
      alt_ref_type_id:
    data_source: arbodat_data
    query: select [Projekt], [Befu], [ProbNr], [ProbTyp], [ArchDat], [ChronoDat] from [Proben] ;
  sample_coordinate:
    type: sql
    source:
    public_id: sample_coordinate_id
    keys: [Projekt, Befu, ProbNr, coordinate_type]
    columns:
    - KoordX
    - KoordY
    - KoordZ
    - TiefeBis
    - TiefeVon
    - Prob_üNN
    foreign_keys:
    - entity: sample
      local_keys: '@value: entities.sample.keys'
      remote_keys: '@value: entities.sample.keys'
      how: left
    - entity: coordinate_method_dimension
      local_keys: [coordinate_type]
      remote_keys: [arbodat_dimension_code]
      how: left
    depends_on: [sample, dimension, coordinate_method_dimension]
    drop_duplicates: '@value: entities.sample.keys'
    drop_empty_rows: [coordinate_value]
    unnest:
      id_vars: '@value: entities.sample.keys'
      value_vars: '@value: entities.sample_coordinate.columns'
      var_name: coordinate_type
      value_name: coordinate_value
    data_source: arbodat_data
    query: select [Projekt], [Befu], [ProbNr], [KoordX], [KoordY], [KoordZ], [TiefeBis], [TiefeVon], [Prob_üNN] from [Proben] ;
  sample_description_type:
    type: fixed
    source:
    public_id: sample_description_type_id
    keys: []
    columns: [system_id, sample_description_type_id, type_name, type_description, arbodat_code]
    values:
    - [1, null, 'Is mass find?', Indicates of sample is a mass find., Vorfu]
    - [2, null, Wet/dry, Ablagerungsbedingungen, Trocken]
    - [3, null, Stratigraphy, Stratigraphic unit or description., Strat]
    - [4, null, Layer, Layer identifier, Schi]
    - [5, null, Square/Grid, Excavation square/grid square., Quadr]
    - [6, null, Planum, Planum, Plan]
    - [7, null, Elevation ASL, Elevation of sample above sea level., Prob_üNN]
    - [8, null, Sediment, Indicates whether the sample is sediment., SedProb]
    - [9, null, Cultural group, Cultural group, KultGr]
    surrogate_name: type_name
    type_names:
    - Vorfu
    - Trocken
    - Strat
    - Schi
    - Quadr
    - Plan
    - Prob_üNN
    - SedProb
    - KultGr
  sample_description:
    type: sql
    source:
    public_id: sample_description_id
    keys: []
    columns: '@value: entities.sample.keys + @value: entities.sample_description_type.type_names'
    foreign_keys:
    - entity: sample_description_type
      local_keys: [type_name]
      remote_keys: [arbodat_code]
    - entity: sample
      local_keys: '@value: entities.sample.keys'
      remote_keys: '@value: entities.sample.keys'
    depends_on: [sample, sample_description_type]
    drop_duplicates: true
    drop_empty_rows: [description_value]
    unnest:
      id_vars: '@value: entities.sample.keys'
      value_vars: '@value: entities.sample_description_type.type_names'
      var_name: type_name
      value_name: description_value
    data_source: arbodat_data
    query: "select distinct [Projekt], [Befu], [ProbNr],\n       [Vorfu], [Trocken], [Strat], [Schi],\n       [Quadr], [Plan], [Prob_üNN], [SedProb], [KultGr]\nfrom [Proben] ;\n"
  sample_group:
    type: entity
    source: feature
    public_id: sample_group_id
    keys: [site_id, Projekt, Befu]
    columns: [Projekt, Befu]
    depends_on: [feature]
    drop_duplicates: true
    extra_columns:
      sample_group_name: Befu
      sample_group_description:
      sampling_context_id:
      method_id:
  sample_type:
    type: sql
    public_id: sample_type_id
    keys: [ProbTyp]
    columns: [ProbTyp, PrTyp, Nummer]
    drop_duplicates: [ProbTyp]
    extra_columns:
      sample_type_name: ProbTyp
      sample_type_description: PrTyp
    data_source: arbodat_lookup
    query: select distinct [ProbTyp], [PrTyp], [Nummer] from [Probentypen] ;
  site:
    type: sql
    source:
    public_id: site_id
    keys: [Fustel, EVNr]
    columns:
    - Fustel
    - EVNr
    - FustelTyp
    - KoordSys
    - rWert
    - hWert
    - üNN
    foreign_keys:
    - entity: site_type
      local_keys: [FustelTyp]
      remote_keys: [FustelTyp]
      constraints:
        allow_unmatched_left: false
        allow_null_keys: false
        cardinality: many-to-one
      how: left
    depends_on: [site_type]
    drop_duplicates: [Fustel, EVNr]
    check_functional_dependency: true
    extra_columns:
      site_name: Fustel
      national_site_identifier: EVNr
      coordinate_system: KoordSys
      latitude_dd: rWert
      longitude_dd: hWert
      altitude: üNN
    data_source: arbodat_data
    query: select distinct p.Fustel, p.EVNr, b.FustelTyp, p.KoordSys, p.rWert, p.hWert, p.[üNN] from Projekte as p inner join ( select distinct Projekt, FustelTyp from Befunde ) as b on p.Projekt = b.Projekt;
    strict_functional_dependency: false
  site_location:
    type: sql
    source:
    public_id: site_location_id
    keys: []
    columns: '@value: entities.site.keys + @value: entities.location.columns'
    foreign_keys:
    - entity: site
      local_keys: '@value: entities.site.keys'
      remote_keys: '@value: entities.site.keys'
    - entity: location
      local_keys: [location_type, location_name]
      remote_keys: [location_type, location_name]
    depends_on: [site, location]
    drop_duplicates: '@value: entities.site_location.columns'
    unnest:
      id_vars: '@value: entities.site.keys'
      value_vars: '@value: entities.location.columns'
      var_name: location_type
      value_name: location_name
    data_source: arbodat_data
    query: "select distinct [Fustel], [EVNr], [Ort], [Kreis], [Land], [Staat], [FlurStr] from [Projekte] ;\n"
  site_natural_region:
    type: sql
    source:
    public_id: site_natural_region_id
    keys: [Fustel, EVNr]
    columns: [Fustel, EVNr, NaturE]
    foreign_keys:
    - entity: natural_region
      local_keys: '@value: entities.natural_region.keys'
      remote_keys: '@value: entities.natural_region.keys'
    - entity: site
      local_keys: '@value: entities.site.keys'
      remote_keys: '@value: entities.site.keys'
    depends_on: [site, natural_region]
    drop_duplicates: [Fustel, EVNr]
    check_functional_dependency: true
    data_source: arbodat_data
    query: "select distinct Fustel, EVNr, NaturE\nfrom Projekte\nwhere NaturE is not null ;\n"
    strict_functional_dependency: true
  site_property_type:
    type: fixed
    source:
    public_id: site_property_type_id
    keys: []
    columns: [system_id, site_property_type_id, site_property_type, description, arbodat_code]
    values:
    - [1, null, Limes, Location relative to the Roman Limes (for Roman Imperial period sites), Limes]
    - [2, null, okFustel, 'Methodological assessment of the site: adequate or deficient', okFustel]
    - [3, null, Map sheet, 'TK 25 (Topographic Map 1:25,000)', TK]
    - [4, null, EVNr, 'LfD excavation record number, according to the State Office for Monument Preservation (LfD)', EVNr]
    - [5, null, AnmFustel, 'e.g., pollen analysis by NN; soil science by NN; anthropology, etc.', AnmFustel]
    depends_on: []
    surrogate_name: site_property_type
  site_property:
    type: sql
    source:
    public_id: site_property_id
    keys: [Fustel, EVNr, site_property_type]
    columns:
    - Fustel
    - EVNr
    - okFustel
    - Limes
    - TK
    - AnmFustel
    foreign_keys:
    - entity: site
      local_keys: '@value: entities.site.keys'
      remote_keys: '@value: entities.site.keys'
    - entity: site_property_type
      local_keys: ['@value: entities.site_property_type.surrogate_name']
      remote_keys: [arbodat_code]
    depends_on: [site, site_property_type]
    drop_duplicates: [Fustel, EVNr, site_property_type]
    check_functional_dependency: false
    unnest:
      id_vars: [Fustel, EVNr]
      value_vars: '@value: entities.site_property.columns'
      var_name: site_property_type
      value_name: site_property_value
    data_source: arbodat_data
    query: "select distinct [Fustel], [EVNr], [okFustel], [Limes], [TK], [AnmFustel] from [Projekte] ;\n"
  site_type_group:
    type: sql
    source:
    public_id: site_type_group_id
    keys: [FuTypGrup]
    columns: [FuTypGrup, Beschreibung]
    depends_on: []
    extra_columns:
      site_type_group: FuTypGrup
      description: Beschreibung
      arbodat_code: FuTypGrup
    data_source: arbodat_lookup
    query: select distinct [FuTypGrup], [Beschreibung] from [FundtypGruppe];
  site_type:
    type: sql
    source:
    public_id: site_type_id
    keys: [FustelTyp]
    columns: [FustelTyp, FuTypGrup, Beschreibung]
    foreign_keys:
    - entity: site_type_group
      local_keys: [FuTypGrup]
      remote_keys: [FuTypGrup]
      constraints:
        allow_unmatched_left: false
        allow_null_keys: false
        cardinality: many-to-one
    depends_on: [site_type_group]
    drop_duplicates: '@value: entities.site_type.keys'
    extra_columns:
      site_type: FustelTyp
      description: Beschreibung
    data_source: arbodat_lookup
    query: select [FustelTyp], [FuTypGrup], [Beschreibung] from [Fundstellentyp];
  _pcodes:
    type: sql
    source:
    public_id: _pcodes_id
    keys: [PCODE]
    columns: [PCODE]
    depends_on: []
    drop_duplicates: [PCODE]
    data_source: arbodat_data
    query: select distinct [PCODE] from [Details] ;
  taxa:
    type: sql
    public_id: taxon_id
    keys: [PCODE]
    columns:
    - taxon_id
    - PCODE
    - BNam
    - Name_E
    - Fam
    - S_Od
    - TaxAut
    - Achtung
    depends_on: [_pcodes]
    filters:
    - type: exists_in
      column: PCODE
      other_entity: _pcodes
      other_column: PCODE
    extra_columns:
      system_id:
      author_id:
      genus_id:
      species: BNam
    data_source: arbodat_lookup
    query: "select distinct t.[PCODE], t.[BNam], t.[Name_E], t.[Fam], t.[S_Od], t.[TaxAut], t.[Achtung]\r\nfrom [ÖkoSozDaten] t ;"
  taxa_use_categories:
    type: sql
    source:
    public_id: use_category_id
    keys: [PCODE]
    columns:
    - PCODE
    - Ess
    - Gar
    - Ge
    - Hü
    - Imp
    - Kp
    - Med
    - Nut
    - Öl
    foreign_keys:
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    depends_on: [taxa]
    data_source: arbodat_lookup
    query: select [PCODE], [Ess], [Gar], [Ge], [Hü], [Imp], [Kp], [Med], [Nut], [Öl] from [ÖkoSozDaten];
  taxa_plant_sociological_behaviour:
    type: sql
    source:
    public_id: plant_sociological_behaviour_id
    keys: [PCODE]
    columns:
    - PCODE
    - G
    - G_u
    - Kl
    - Kl_u
    - O
    - O_u
    - Soz
    - Soz_u
    - U
    - U_u
    - V
    - V_u
    - Ökogruppe
    - Ökogruppe_u
    foreign_keys:
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    depends_on: [taxa]
    data_source: arbodat_lookup
    query: "select [PCODE], [G], [G_u], [Kl], [Kl_u], [O], [O_u], [Soz], [Soz_u], [U], [U_u], [V], [V_u], [Ökogruppe], [Ökogruppe_u]\nfrom [ÖkoSozDaten];\n"
  taxa_dominance:
    type: sql
    source:
    public_id: dominance_id
    keys: [PCODE]
    columns: [PCODE, Dom, Dom_u]
    foreign_keys:
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    depends_on: [taxa]
    data_source: arbodat_lookup
    query: "select [PCODE], [Dom], [Dom_u]\nfrom [ÖkoSozDaten];\n"
  taxa_oberdorfer_characteristics:
    type: sql
    source:
    public_id: oberdorfer_characteristics_id
    keys: [PCODE]
    columns:
    - PCODE
    - Anm
    - ARE
    - BLA
    - BLE
    - Pio
    - Roh
    - SozGrup
    - WT
    - WUA
    - WUE
    - Zeig
    foreign_keys:
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    depends_on: [taxa]
    data_source: arbodat_lookup
    query: "select [PCODE], [Anm], [ARE], [BLA], [BLE], [Pio], [Roh], [SozGrup], [WT], [WUA], [WUE], [Zeig]\nfrom [ÖkoSozDaten];\n"
  taxa_persistence:
    type: sql
    source:
    public_id: persistence_id
    keys: [PCODE]
    columns: [PCODE, Bl, Bl_u, Leb]
    foreign_keys:
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    depends_on: [taxa]
    data_source: arbodat_lookup
    query: "select [PCODE], [Bl], [Bl_u], [Leb]\nfrom [ÖkoSozDaten];\n"
  taxa_briemle_characteristics:
    type: sql
    source:
    public_id: briemle_characteristics_id
    keys: [PCODE]
    columns: [PCODE, FW, M, TKG, W]
    foreign_keys:
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    depends_on: [taxa]
    data_source: arbodat_lookup
    query: "select [PCODE], [FW], [M], [TKG], [W]\nfrom [ÖkoSozDaten];\n"
  taxa_ecological_behaviour:
    type: sql
    source:
    public_id: ecological_behaviour_id
    keys: [PCODE]
    columns:
    - PCODE
    - F
    - F_s
    - F_u
    - K
    - K_u
    - L
    - L_u
    - N
    - N_u
    - Re
    - Re_u
    - S
    - S_u
    - SMet
    - T
    - T_u
    foreign_keys:
    - entity: taxa
      local_keys: [PCODE]
      remote_keys: [PCODE]
    depends_on: [taxa]
    data_source: arbodat_lookup
    query: "select [PCODE], [F], [F_s], [F_u], [K], [K_u], [L], [L_u], [N], [N_u], [Re], [Re_u], [S], [S_u], [SMet], [T], [T_u]\nfrom [ÖkoSozDaten];\n"
  _project_contact:
    type: sql
    source:
    public_id: project_contact_id
    keys: [Projekt, contact_type, contact_name]
    columns: [Projekt, ArchAusg, ArchBear, BotBear]
    drop_duplicates: [Projekt, contact_type, contact_name]
    unnest:
      id_vars: [Projekt]
      value_vars: [ArchAusg, ArchBear, BotBear]
      var_name: contact_type
      value_name: contact_name
    data_source: arbodat_data
    query: "select distinct [Projekt], [ArchAusg], [ArchBear], [BotBear] from [Projekte] ;\n"
  abundance_ident_level:
    type: entity
    source: abundance
    public_id: abundance_ident_level_id
    keys: []
    columns: []
options:
  translations:
    filename: translations.tsv
    delimiter: "\t"
  data_sources:
    sead: '@include: data-sources/sead-options.yml'
    arbodat_data: '@include: data-sources/arbodat-data-options.yml'
    arbodat_lookup: '@include: data-sources/arbodat-lookup-options.yml'
  translation: '@load: options.translations'
  reconciliation: '@include: reconciliation.yml'
  finally:
    drop:
      tables: [_pcodes, _project_contact]
      columns:
      - site.public_id
      - project.public_id
      - feature.public_id
      - sample.public_id
      - analysis_entity.public_id
      - abundance.public_id
      - location.public_id
  ingesters:
    sead:
      data_source: sead
      options:
        transfer_format: csv
        ignore_columns: [date_updated, '*_uuid', (*]
      policies:
        if_foreign_key_value_is_missing_add_identity_mapping_to_foreign_key_table:
          priority: 1
        set_public_id_to_negative_system_id_for_new_lookups:
          disabled: true
        update_missing_foreign_key_policy:
          tbl_dataset_contacts:
            contact_type_id: 2
            contact_id: 1
        if_lookup_table_is_missing_add_table_using_system_id_as_public_id:
          tables:
          - tbl_abundance_elements
          - tbl_contact_types
          - tbl_dataset_submission_types
          - tbl_location_types
          - tbl_project_types
          - tbl_project_stages
          - tbl_relative_ages
          - tbl_sample_group_sampling_contexts
          - tbl_sample_types
          preallocated_tables: []
        if_lookup_with_no_new_data_then_keep_only_system_id_public_id:
          priority: 9
        drop_ignored_columns:
          priority: 3
          columns: [date_updated, '*_uuid']
  layout:
    custom:
      abundance:
        x: 800.7583693390105
        y: 263.596828177525
      abundance_element:
        x: 969.9983522720851
        y: 99.1625645787425
      abundance_element_group:
        x: 1225.4028538394189
        y: -18.696360490598774
      abundance_modification:
        x: 679.9621205759468
        y: 403.5097960786728
      abundance_property:
        x: 1081.5274290053756
        y: 371.31905868772077
      abundance_property_type:
        x: 1218.2233529230089
        y: 185.20607106407294
      analysis_entity:
        x: 479.0846770650836
        y: 329.7137919898175
      archaeological_period:
        x: -220.65831563998563
        y: -3.2056784837848964
      chronological_period:
        x: -23.044311766521098
        y: 206.7015594988265
      contact:
        x: 304.11186486138183
        y: -212.00228623344566
      contact_type:
        x: 49.995015637808294
        y: -265.7780988776727
      coordinate_method_dimension:
        x: -360.3403825093001
        y: 751.4577901143806
      coordinate_system:
        x: -2.40132994809761
        y: 834.6189577713575
      cultural_group:
        x: -1127.0999841748728
        y: -689.6299481962747
      dataset:
        x: 227.99300398788472
        y: 438.70380421127135
      dataset_contacts:
        x: 181.933029701239
        y: 12.4261097731702
      dataset_submission:
        x: -63.07856592730473
        y: 635.507639032086
      dataset_submission_type:
        x: -65.60028915351917
        y: 434.35899511760664
      dating:
        x: -286.12499705566006
        y: 463.8814001904039
      dating_period:
        x: -294.9416175978901
        y: 168.10010308072478
      dimension:
        x: -673.6161662944113
        y: 784.6052278230642
      epoch:
        x: -111.79063450092535
        y: -78.52783537827045
      feature:
        x: -493.4100814221007
        y: 111.91818178439024
      feature_property:
        x: -425.7603578471129
        y: -65.00133006637424
      feature_property_type:
        x: -669.63565460965
        y: -131.1302442433776
      feature_type:
        x: -699.3102176652066
        y: -11.131882281507394
      identification_level:
        x: 1038.5857499228528
        y: 625.5932338946146
      location:
        x: 120.38364237217819
        y: -447.89543860080363
      location_type:
        x: 118.895496767992
        y: -589.8630498251201
      master_dataset:
        x: 208.52436375649847
        y: 602.6985675509331
      method:
        x: 426.9493937714245
        y: 710.9055144284449
      method_group:
        x: 295.55250688496096
        y: 897.9718854246327
      modification_type:
        x: 607.5819242674804
        y: 546.6446493829447
      natural_region:
        x: -858.4162068916929
        y: -366.4178535766868
      natural_region_group:
        x: -1120.0698509994065
        y: -273.5392004244319
      project:
        x: -87.62173342410966
        y: -200.85327381418122
      relative_dating:
        x: -417.8067052188633
        y: 555.3898312625704
      sample:
        x: -498.87985287550634
        y: 352.50317083403354
      sample_coordinate:
        x: -733.9151841845722
        y: 568.3348221218124
      sample_description_type:
        x: -1058.6108642333281
        y: 563.6761251498986
      sample_description:
        x: -869.2949255195182
        y: 428.26561688954166
      sample_group:
        x: -797.7366567063895
        y: 96.75843852520387
      sample_type:
        x: -895.431354981279
        y: 253.71330566055693
      site:
        x: -442.9727167199261
        y: -331.93419594262906
      site_location:
        x: -101.00049359313489
        y: -374.21611201782025
      site_natural_region:
        x: -711.7269641662831
        y: -242.42711870489907
      site_property_type:
        x: -435.3048642245011
        y: -650.5939732832334
      site_property:
        x: -573.6245872873017
        y: -520.0306028641145
      site_type_group:
        x: -104.25719795102707
        y: -566.6850590512648
      site_type:
        x: -263.1201469160366
        y: -465.54123278194436
      _pcodes:
        x: 472.58637992148994
        y: -173.20463302972863
      taxa:
        x: 707.466579591301
        y: -87.97238632118194
      taxa_use_categories:
        x: 886.9984191829759
        y: -39.91624980003752
      taxa_plant_sociological_behaviour:
        x: 1116.4482242399126
        y: -166.48457206292534
      taxa_dominance:
        x: 1141.1992802307689
        y: -263.6994168980955
      taxa_oberdorfer_characteristics:
        x: 858.3995458732765
        y: -484.53851365088303
      taxa_persistence:
        x: 1075.941788886751
        y: -432.8931967178668
      taxa_briemle_characteristics:
        x: 504.3537370983374
        y: -322.48697262164836
      taxa_ecological_behaviour:
        x: 618.8894485913696
        y: -448.6066271602773
      _project_contact:
        x: 422.95602463673845
        y: -14.265947983989674
      abundance_ident_level:
        x: 822.9539797622327
        y: 727.8040417164782
    _metadata:
      last_updated: '2026-02-13T04:42:26.470253+00:00'
      layout_version: 1
task_list:
  required_entities:
  - abundance_modification
  - abundance_property
  - contact
  - coordinate_system
  - cultural_group
  - dataset_contacts
  - dataset_submission
  - dataset_submission_type
  - dating
  - dating_period
  - feature_property
  - identification_level
  - master_dataset
  - method_group
  - relative_dating
  - sample_coordinate
  - sample_description
  - site_location
  - site_natural_region
  - site_property
  - taxa_use_categories
  - taxa_plant_sociological_behaviour
  - taxa_dominance
  - taxa_oberdorfer_characteristics
  - taxa_persistence
  - taxa_briemle_characteristics
  - taxa_ecological_behaviour
  - modification_type
  - abundance
  - abundance_property_type
  - contact_type
  - _project_contact
  - dataset
  - archaeological_period
  - chronological_period
  - feature_property_type
  - coordinate_method_dimension
  - sample_description_type
  - location
  - natural_region
  - site_property_type
  - abundance_element
  - analysis_entity
  - epoch
  - dimension
  - location_type
  - natural_region_group
  - abundance_element_group
  - method
  - taxa
  - sample
  - _pcodes
  - sample_type
  - sample_group
  - feature
  - feature_type
  - project
  - site
  - site_type
  - site_type_group
  completed: []
  ignored:
  - taxa_briemle_characteristics
  - taxa_ecological_behaviour
  - taxa_oberdorfer_characteristics
  - taxa_dominance
  - taxa_plant_sociological_behaviour
  - taxa_persistence
