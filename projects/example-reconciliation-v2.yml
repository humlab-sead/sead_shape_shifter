# Example SEAD Reconciliation Configuration (Format v2.0)
# This file demonstrates reconciliation setup for common entity types

# Format version
version: "2.0"

# Base URL of the OpenRefine reconciliation service
service_url: "http://localhost:8000"

# Entity-specific reconciliation specifications
# Format: entities[entity_name][target_field] = specification
entities:
  
  # Example: Site reconciliation with geographic properties
  # Single target field: site_name
  site:
    site_name:  # Target field for reconciliation
      # Optional: specify data source for reconciliation
      # - null/empty/same as entity name: use entity preview data (default)
      # - another entity name: use that entity's preview data
      # - dict with data_source/type/query: execute custom query
      source: null  # Use site entity preview data
      
      property_mappings:
        # Map SEAD service property IDs to source column names
        latitude: site_latitude       # Geographic coordinates
        longitude: site_longitude
        country: country_name         # Location context
        national_id: national_site_id # Official identifier
        place_name: locality          # Additional location info
      
      remote:
        service_type: "site"  # Must match service defaultTypes
      
      auto_accept_threshold: 0.95  # Auto-accept ≥95% confidence
      review_threshold: 0.70       # Review 70-95% confidence
      
      mapping: []  # Auto-populated during reconciliation

  # Example: Taxon reconciliation using another entity's data
  # Multiple target fields: species_name AND genus (for different use cases)
  taxon:
    species_name:  # Primary reconciliation target
      # Use enriched taxon data from a temporary/helper entity
      source: "taxon_with_hierarchy"  # Entity with additional taxonomic fields
      
      property_mappings:
        genus: genus_col           # Taxonomic hierarchy
        family: family_col
        scientific_name: binomial  # Full scientific name
      
      remote:
        service_type: "taxon"
      
      auto_accept_threshold: 0.90
      review_threshold: 0.65
      
      mapping: []
    
    genus:  # Alternative target - reconcile at genus level
      source: "taxon_with_hierarchy"
      
      property_mappings:
        family: family_col
      
      remote:
        service_type: "taxon"
      
      auto_accept_threshold: 0.95
      review_threshold: 0.70
      
      mapping: []

  # Example: Using custom SQL query for reconciliation data
  site_with_coordinates:
    site_name:
      source:
        data_source: "arbodat_data"  # Data source name from main config
        type: sql
        query: |
          SELECT 
            Fustel AS site_name,
            EVNr AS national_site_identifier,
            rWert AS latitude,
            hWert AS longitude,
            Ort AS locality
          FROM Projekte
          WHERE rWert IS NOT NULL AND hWert IS NOT NULL
      
      property_mappings:
        latitude: latitude
        longitude: longitude
        national_id: national_site_identifier
        place_name: locality
      
      remote:
        service_type: "site"
      
      auto_accept_threshold: 0.95
      review_threshold: 0.70
      
      mapping: []

  # Example: Bibliographic reference with structured identifiers
  bibliographic_reference:
    citation:  # Target field: full citation text
      property_mappings:
        doi: doi_column           # Digital Object Identifier
        title: ref_title
        year: publication_year
        authors: author_names
        isbn: isbn_number
      
      remote:
        service_type: "bibliographic_reference"
      
      auto_accept_threshold: 0.98  # Strict matching for references
      review_threshold: 0.85
      
      mapping: []

  # Example: Location/place reconciliation
  location:
    place_name:
      property_mappings:
        place_name: location_name  # Alternative spellings
      
      remote:
        service_type: "location"
      
      auto_accept_threshold: 0.92
      review_threshold: 0.75
      
      mapping: []

  # Example: Country reconciliation (simple, no properties needed)
  country:
    country_name:
      property_mappings: {}  # No additional properties
      
      remote:
        service_type: "country"
      
      auto_accept_threshold: 0.98  # High threshold for country names
      review_threshold: 0.90
      
      mapping: []

  # Example: Method with abbreviation
  method:
    method_name:
      property_mappings:
        method_abbreviation: abbrev  # Method abbreviation
      
      remote:
        service_type: "method"
      
      auto_accept_threshold: 0.95
      review_threshold: 0.75
      
      mapping: []

  # Example: Entity with reconciliation disabled
  sample:
    sample_name:
      property_mappings: {}
      
      remote:
        service_type: null  # Reconciliation disabled - no service type
      
      mapping: []

# Mapping Format (auto-populated):
# Each mapping entry in the v2 format uses a single source_value:
#
# mapping:
#   - source_value: "Övre Långsjön"        # Single value (not array)
#     target_id: 12345
#     confidence: 0.98
#     notes: "Auto-matched by reconciliation service"
#     created_at: "2024-01-15T10:30:00"
#     created_by: "reconciliation_service"
#   - source_value: "Unknown Site X"
#     target_id: null
#     will_not_match: true
#     notes: "Local-only site, not in SEAD"
